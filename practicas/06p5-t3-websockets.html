<!doctype html>
<html lang=" en-US ">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=88e715cdd6e0bd047c7d68b39d123a466842e492">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

</head>

<body>
    <div id="header">
        <nav>
    <li><a href="/search" title="search">&#x1F50D;</a></li>
    <!--
    <li><a href="#sytwstoc" title="Table of Contents">‚â°</a></li>
    -->

      
    <li><a href="/practicas/05p4-t2-networking.html" title="Previous">&#x2190;</a></li>
    
    
    <li><a href="https://github.com/ULL-MII-SYTWS-1920/ull-mii-sytws-1920.github.io/tree/master//_practicas/06p5-t3-websockets.md" title="Edit this page at GitHub">üêô</a>
    
    <li><a href="/references.html" title="Bibliograf√≠a">&#x1f4da</a></li>
    <li><a href="/practicas.html" title="Pr√°cticas">&#x270d</a></li>
    
    <li><a href="/clases.html" title="Clases">üë®‚Äçüè´</a></li>

    <li><a href="/" title="Home page">&#x1f3e0</a></li>
    <li><a href="/tema0-presentacion/" title="Tema 0: Presentaci√≥n">0</a></li>
    <li><a href="/tema1-introduccion/" title="Tema 1: Introducci√≥n">1</a></li>
    <li><a href="/tema2-async/" title="Tema 2: Async">2</a></li>
    <li><a href="/tema3-web/" title="Tema 3: Web">3</a></li>
    <li><a href="/tema4-devops/" title="Tema 4: Devop">4</a></li>
    
</nav>

    </div>
    <!-- end header -->


    <div class="wrapper">

        <section>
            
<div id="title">
        <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
        <p> Master de II. ULL. 1er cuatrimestre. 2020/2021</p>
        <hr>
        <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-2021" target="_blank">ULL-MII-SYTWS-2021</a></span>
        <span class="credits left"> &nbsp; Classroom <a href="https://classroom.github.com/classrooms/68184806-ull-mii-sytws-2021" target="_blank">ULL-MII-SYTWS-2021</a></span>
        <span class="credits left"> &nbsp; Campus Virtual <a href="https://campusdoctoradoyposgrado.ull.es/course/view.php?id=2020111300" target="_blank">SYTWS</a></span>
        <span class="credits left"> &nbsp; Chat <a href="https://chat.google.com/u/1/room/AAAAp18fCE8" target="_blank">Chat</a></span>
        <span class="credits left"> &nbsp; Profesor <a href="https://www.ull.es/apps/guias/guias/view_teacher_niu/745/(%3FPcrguezl.*)/" target="_blank">Casiano</a></span>
    </div>

<!--

<div id="title">
    <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
    <p> Master de II. ULL. 1er cuatrimestre. 2020/2021</p>
    <hr>
    <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-1920"
            target="_blank">ULL-MII-SYTWS-1920</a></span>
    <span class="credits left"> &nbsp; Github Classroom <a
            href="https://classroom.github.com/classrooms/55384072-master-de-ingenieria-informatica-sistemas-y-tecnologias-web-servidor-classroom"
            target="_blank">SYTWS 19/20</a></span>
    <span class="credits left"> &nbsp; Campus Virtual <a
            href="https://campusvirtual.ull.es/1920/course/view.php?id=201913778" target="_blank">SYTWS
            19/20</a></span>
    <span class="credits left"> &nbsp; Profesor <a
            href="https://www.ull.es/apps/guias/guias/view_teacher_niu/588/(%3FPcrguezl.*)/"" target="
            _blank">Casiano</a></span>
</div>
-->    

            
            



            <h2 >Table of Contents</h2>
            
            <ul id="sytwstoc">
  <li><a href="#pr√°ctica-p5-t3-websockets">Pr√°ctica p5-t3-websockets</a>
    <ul>
      <li><a href="#reto-1-para-la-pr√°ctica-p5-t3-websockets">Reto 1 para la pr√°ctica p5-t3-websockets</a>
        <ul>
          <li><a href="#tip-decida-en-que-lugar-del-documento-saldr√°-el-mensaje--is-typing">Tip: Decida en que lugar del documento saldr√° el mensaje <code class="language-plaintext highlighter-rouge">... is typing</code></a></li>
          <li><a href="#tip-como-escuchar-por-las-pulsaciones-de-teclas">Tip: Como escuchar por las pulsaciones de teclas</a></li>
        </ul>
      </li>
      <li><a href="#reto-2-para-la-pr√°ctica-p5-t3-websockets">Reto 2 para la pr√°ctica p5-t3-websockets</a>
        <ul>
          <li><a href="#usando-namespaces">Usando namespaces</a></li>
          <li><a href="#usando-rooms">Usando rooms</a></li>
        </ul>
      </li>
      <li><a href="#recursos">Recursos</a></li>
    </ul>
  </li>
</ul>
          

            <div class="container">
                <h1 id="pr√°ctica-p5-t3-websockets">Pr√°ctica p5-t3-websockets</h1>

<p>Lea el cap√≠tulo <a href="https://javascript.info/websocket">WebSocket</a> del libro <a href="https://javascript.info/">The Modern JavaScript Tutorial</a> y haga un resumen de lo aprendido.</p>

<p>Estudie tambi√©n y desarrolle el ejemplo explicado en:</p>

<ul>
  <li><a href="https://medium.com/@noufel.gouirhate/build-a-simple-chat-app-with-node-js-and-socket-io-ea716c093088">Build a simple chat app with node.js and socket.io</a> By Noufel Gouirhate Dec 24, 2017  Medium.com
    <ul>
      <li>Puede encontrar el c√≥digo en este <a href="https://github.com/ULL-ESIT-DSI-1819/simpleChatApp">Repo ULL-ESIT-DSI-1819/simpleChatApp</a></li>
    </ul>
  </li>
  <li>Despliegue la aplicaci√≥n en Heroku y en iaas.ull.es
    <ul>
      <li>Para el despliegue en Heroku deber√° leer el art√≠culo: <a href="https://devcenter.heroku.com/articles/node-websockets">Using WebSockets on Heroku with Node.js</a></li>
      <li>Repo <a href="https://github.com/ULL-ESIT-DSI-1819/websocket-socket-io-heroku">ULL-ESIT-DSI-1819/websocket-socket-io-heroku</a></li>
      <li>
        <p>Aqu√≠ es esencial habilitar <a href="https://devcenter.heroku.com/articles/session-affinity">session affinity</a>:</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[~/local/src/javascript/learning/websockets/websockets-heroku-socket-io(master)]$ heroku features:enable http-session-affinity
Enabling http-session-affinity for ‚¨¢ dsi-socket-io-example... done
</pre></td></tr></tbody></table></code></pre></div>        </div>

        <p>Session affinity, sometimes referred to as sticky sessions, is a platform feature that associates all HTTP requests coming from an end-user with a single application instance (web dyno).</p>
      </li>
      <li>Repo <a href="https://github.com/ULL-ESIT-DSI-1819/websocket-ws-heroku">ULL-ESIT-DSI-1819/websocket-ws-heroku</a></li>
    </ul>
  </li>
</ul>

<h2 id="reto-1-para-la-pr√°ctica-p5-t3-websockets">Reto 1 para la pr√°ctica p5-t3-websockets</h2>

<ul>
  <li>Add <em>{user} is typing ‚Ä¶</em> functionality.</li>
</ul>

<p><img src="/assets/images/reto-user-is-typing.png" alt="user is typing" /></p>

<h3 id="tip-decida-en-que-lugar-del-documento-saldr√°-el-mensaje--is-typing">Tip: Decida en que lugar del documento saldr√° el mensaje <code class="language-plaintext highlighter-rouge">... is typing</code></h3>

<p>En el HTML, deber√° decidir donde va a aparecer el mensaje de <em>feedback</em> indicando que un usuario
esta tecleando y a√±adirle un <code class="language-plaintext highlighter-rouge">id</code>.<code class="language-plaintext highlighter-rouge"> </code>Por ejemplo:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"feedback"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="tip-como-escuchar-por-las-pulsaciones-de-teclas">Tip: Como escuchar por las pulsaciones de teclas</h3>

<p>Le puede ayudar a√±adir en el c√≥digo del cliente una llamada a el m√©todo <code class="language-plaintext highlighter-rouge">addEventListener</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">target</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">tipo</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">tipo</code>: Una cadena representando el  tipo de evento a escuchar.
    <ul>
      <li>The <a href="https://developer.mozilla.org/en-US/docs/Web/Events/keydown">keydown</a> event is fired when a key is pressed down.</li>
      <li>Unlike the <a href="https://developer.mozilla.org/en-US/docs/Web/Events/keypress">keypress</a> event, the <code class="language-plaintext highlighter-rouge">keydown</code>:w
 event is fired for all keys, regardless of whether they produce a character value.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">listener</code>: normalmente la function que ser√° llamada cuando ocurre el evento <code class="language-plaintext highlighter-rouge">tipo</code> sobre el elemento del DOM representado por <code class="language-plaintext highlighter-rouge">target</code>. En este caso el c√≥digo de <code class="language-plaintext highlighter-rouge">listener</code> deber√° emitir un mensaje indicando que el usuario esta tecleando.</li>
  <li>El server deber√≠a recoger el mensaje y hacer un broadcast del mismo al resto de clientes conectados</li>
</ul>

<h2 id="reto-2-para-la-pr√°ctica-p5-t3-websockets">Reto 2 para la pr√°ctica p5-t3-websockets</h2>

<ul>
  <li>A√±√°da rooms a su chat. Establezca dos rooms llamadas <code class="language-plaintext highlighter-rouge">practicas</code> y <code class="language-plaintext highlighter-rouge">ocio</code></li>
</ul>

<p>Vea los ejemplos en <a href="https://github.com/ULL-ESIT-DSI-1819/socket-io-namespaces">ULL-ESIT-DSI-1819/socket-io-namespaces</a>
y lea la secci√≥n <a href="https://socket.io/docs/rooms-and-namespaces/">Namespaces</a> de la documentaci√≥n de Socket.io</p>

<p>Puede hacer este ejercicio usando namespaces o rooms.</p>

<h3 id="usando-namespaces">Usando namespaces</h3>

<p>En el directorio <code class="language-plaintext highlighter-rouge">ns</code> tiene un ejemplo de como usar <em>namespaces</em>:</p>

<p>Fichero <strong>ns/index.js</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">).</span><span class="nx">Server</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">socket.io</span><span class="dl">'</span><span class="p">)(</span><span class="nx">http</span><span class="p">);</span>

<span class="c1">// view engine setup</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">view engine</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ejs</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/:namespace</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">space</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">space</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">namespace</span><span class="p">});</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">welcome</span><span class="p">(</span><span class="nx">nsp</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="nx">spaceName</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">someone connected to </span><span class="dl">'</span><span class="o">+</span><span class="nx">spaceName</span><span class="p">);</span>
   <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`Welcome client '</span><span class="p">${</span><span class="nx">socket</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">' to </span><span class="p">${</span><span class="nx">spaceName</span><span class="p">}</span><span class="s2">!`</span><span class="p">);</span>
   <span class="nx">nsp</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`Client '</span><span class="p">${</span><span class="nx">socket</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">' joined </span><span class="p">${</span><span class="nx">spaceName</span><span class="p">}</span><span class="s2">!`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">nsp</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="dl">'</span><span class="s1">/my-namespace</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">nsp</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">welcome</span><span class="p">(</span><span class="nx">nsp</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/my-namespace</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">nsp2</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="dl">'</span><span class="s1">/your-namespace</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">nsp2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">welcome</span><span class="p">(</span><span class="nx">nsp2</span><span class="p">,</span> <span class="nx">socket</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/your-namespace</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">listening on localhost:3000</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Fichero <strong>ns/public/index.html</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/my-namespace"</span><span class="nt">&gt;</span>my-namespace<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/your-namespace"</span><span class="nt">&gt;</span>your-namespace<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Fichero <strong>ns/views/space.ejs</strong>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
   <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;title&gt;</span>Hello world<span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;/head&gt;</span>
   <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

   <span class="nt">&lt;script&gt;</span>
      <span class="kd">const</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="dl">'</span><span class="s1">/&lt;%- space %&gt;</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">chat</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">chat</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">chat</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">`&lt;p&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span><span class="p">;</span>
      <span class="p">});</span>
   <span class="nt">&lt;/script&gt;</span>
   <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"chat"</span><span class="nt">&gt;&lt;/div&gt;</span>
   <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="usando-rooms">Usando rooms</h3>

<p>Fichero <strong>rooms/index.js</strong>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">).</span><span class="nx">Server</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">socket.io</span><span class="dl">'</span><span class="p">)(</span><span class="nx">http</span><span class="p">);</span>

<span class="c1">// view engine setup</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">view engine</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ejs</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/:room</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">room</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">room</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">room</span><span class="p">});</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">nsp</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="dl">'</span><span class="s1">/my-namespace</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">nsp</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`Welcome client '</span><span class="p">${</span><span class="nx">socket</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">' to my-namespace!`</span><span class="p">);</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">join</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">room</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">room = </span><span class="dl">"</span><span class="o">+</span><span class="nx">room</span><span class="p">);</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">room</span><span class="p">);</span>
        <span class="nx">nsp</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">room</span><span class="p">).</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span><span class="p">,</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="dl">'</span><span class="s1"> joined room "</span><span class="dl">'</span><span class="o">+</span><span class="nx">room</span><span class="o">+</span><span class="dl">'</span><span class="s1">"</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">someone connected: </span><span class="dl">'</span><span class="o">+</span><span class="nx">socket</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">listening on localhost:3000</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Fichero <strong>rooms/public/index.html</strong>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/room-1"</span><span class="nt">&gt;</span>room-1<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/room-2"</span><span class="nt">&gt;</span>room-2<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Fichero <strong>rooms/views/room.ejs</strong>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
   <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;title&gt;</span>Hello world<span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;/head&gt;</span>
   <span class="nt">&lt;script </span><span class="na">src = </span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

   <span class="nt">&lt;script&gt;</span>
      <span class="kd">const</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="dl">'</span><span class="s1">/my-namespace</span><span class="dl">'</span><span class="p">);</span>

      <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">join</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&lt;%- room %&gt;</span><span class="dl">'</span><span class="p">);</span>

      <span class="kd">let</span> <span class="nx">chat</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">chat</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">chat</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">`&lt;p&gt;</span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span><span class="p">;</span>
      <span class="p">});</span>
   <span class="nt">&lt;/script&gt;</span>
   <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"chat"</span><span class="nt">&gt;&lt;/div&gt;</span>
   <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="recursos">Recursos</h2>

<ul>
  <li>Cap√≠tulo <a href="https://javascript.info/websocket">WebSocket</a> del libro <a href="https://javascript.info/">The Modern JavaScript Tutorial</a></li>
  <li>WebSockets
    <ul>
      <li>Socket.io
        <ul>
          <li><a href="https://socket.io/get-started/chat/">Socket.io Guide: a chat</a>
            <ul>
              <li><a href="https://github.com/socketio/chat-example">Associated Repo</a></li>
            </ul>
          </li>
          <li><a href="https://socket.io/docs/">Docs</a>
            <ul>
              <li><a href="https://socket.io/docs/rooms-and-namespaces/#Default-namespace">Namespaces</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Chats
        <ul>
          <li><a href="https://medium.com/@noufel.gouirhate/build-a-simple-chat-app-with-node-js-and-socket-io-ea716c093088">Build a simple chat app with node.js and socket.io</a> - By Noufel Gouirhate Dec 24, 2017  Medium.com
            <ul>
              <li><a href="https://github.com/ULL-ESIT-DSI-1819/simpleChatApp">Repo ULL-ESIT-DSI-1819/simpleChatApp</a></li>
            </ul>
          </li>
          <li><a href="https://www.youtube.com/playlist?list=PL4cUxeGkcC9i4V-_ZVwLmOusj8YAUhj_9">Web Sockets (Node.js and Socket.io Chat App)</a> in the Net Ninja Youtube Channel
            <ul>
              <li><a href="https://github.com/ULL-ESIT-DSI-1819/websockets-playlist">Repo ULL-ESIT-DSI-1819/websockets-playlist</a></li>
            </ul>
          </li>
          <li><a href="https://medium.com/@chathuranga94/introduction-to-socket-io-600025322cd2">Introduction to Socket.io</a> by Udara Bibile at Medium.com</li>
        </ul>
      </li>
      <li><a href="https://youtu.be/tzNOqcoupWQ">Socket.io &amp; Express NodeJS Tutorial to build a Realtime Chat App</a>
        <ul>
          <li><a href="https://youtu.be/tzNOqcoupWQ">Socket.io &amp; Express NodeJS Tutorial to build a Realtime Chat App - Part 1</a></li>
          <li><a href="https://youtu.be/emnlFamYx7Y">Socket.io &amp; Express NodeJS Tutorial to build a Realtime Chat App - Part 2</a></li>
          <li><a href="https://github.com/ULL-ESIT-DSI-1819/Socket_io_Chat_Room">Corresponding repo at GitHub</a></li>
        </ul>
      </li>
      <li>Real Time Slide Presentation
        <ul>
          <li><a href="https://medium.com/@nafeunasir/real-time-presentation-slides-with-socket-io-express-node-js-and-javascript-cf08a95ff098">Real-time Presentation Slides with Socket.io, Node.js and Javascript</a> by Nafeu Nasir at Medium.com
            <ul>
              <li><a href="https://github.com/ULL-ESIT-DSI-1819/realtime-slides-tut.git">Repo ULL-ESIT-DSI-1819/realtime-slides-tut.git</a></li>
              <li><a href="https://youtu.be/WmE6dkRFY4Y">Real-time Slides Demonstration</a> YouTube</li>
            </ul>
          </li>
          <li><a href="https://bocoup.com/blog/synchronizing-html5-slides-with-node-js">Synchronizing HTML5 slides with Node.js by Tim Branyen</a></li>
        </ul>
      </li>
      <li>Libros
        <ul>
          <li><a href="https://proquest-safaribooksonline-com.accedys2.bbtk.ull.es/9781782160786">Socket.IO Real-time Web Application Development By: Rohit Rai</a> book at PuntoQ ULL
            <ul>
              <li><a href="https://github.com/piscolomo/example-socketio">Repo con soluciones al libro</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Programaci√≥n Web
    <ul>
      <li>Express
        <ul>
          <li><a href="https://casianorodriguezleon.gitbooks.io/ull-esit-1617/content/apuntes/express/">Apuntes de Express 1617</a></li>
        </ul>
      </li>
      <li><a href="https://ejs.co/">ejs</a></li>
      <li>Despliegues
        <ul>
          <li><a href="https://github.com/SYTW/iaas-ull-es">Como Desplegar una Aplicaci√≥n Web en iaas.ull.es</a></li>
          <li><a href="https://casianorodriguezleon.gitbooks.io/ull-esit-1617/content/recursos/heroku.html">Apuntes de Heroku</a></li>
          <li>Para el despliegue en Heroku deber√° leer el art√≠culo: <a href="https://devcenter.heroku.com/articles/node-websockets">Using WebSockets on Heroku with Node.js</a></li>
          <li>Repo <a href="https://github.com/ULL-ESIT-DSI-1819/websocket-socket-io-heroku">ULL-ESIT-DSI-1819/websocket-socket-io-heroku</a></li>
          <li>
            <p>Aqu√≠ es esencial habilitar <a href="https://devcenter.heroku.com/articles/session-affinity">session affinity</a>:</p>

            <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[~/local/src/javascript/learning/websockets/websockets-heroku-socket-io(master)]$ heroku features:enable http-session-affinity
Enabling http-session-affinity for ‚¨¢ dsi-socket-io-example... done
</pre></td></tr></tbody></table></code></pre></div>            </div>

            <p>Session affinity, sometimes referred to as sticky sessions, is a platform feature that associates all HTTP requests coming from an end-user with a single application instance (web dyno).</p>
          </li>
        </ul>
      </li>
      <li>Webpack
        <ul>
          <li><a href="https://webpack.js.org/guides/getting-started/">Webpack guide: ‚Äúgetting started‚Äù</a></li>
          <li><a href="https://youtu.be/vF2emKbaP4M">Youtube video Webpack 4 por Fatz</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


            </div>
                        <details>
                <summary><h2>Comment with GitHub Utterances</h2></summary>
                <script src="https://utteranc.es/client.js"
        repo="ULL-MII-SYTWS-1920/ull-mii-sytws-1920.github.io"
        issue-term="pathname"
        label="SYTWS"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>
            </details>
            
            <details>
                <summary>
                   <h2>Comment with Disqus</h2> 
                </summary>              
                



<div id="disqus_thread">
    thread de discusion
</div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: 
EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
       https://disqus.com/admin/universalcode/#configuration-variables*/

/*
var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://https-ull-mii-sytws-1920-github-io.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
   (d.head || d.body).appendChild(s);
})();

</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            

 

            </details>
        </section>
    
    </div>


    
</body>

</html>
