<!doctype html>
<html lang=" en-US ">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=88e715cdd6e0bd047c7d68b39d123a466842e492">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->

    
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        
    
</head>

<body>
    <div id="header">
            <nav>
        <li><a href="https://github.com/ULL-MII-SYTWS-1920/ull-mii-sytws-1920.github.io/tree/master//tema2-async/async-js.md" title="Edit this page at GitHub">üêô</a>
        </li>
        <li><a href="/search" title="search">&#x1F50D;</a></li>
       
        <li><a href="/resources.html" title="resources">&#x2699</a></li>
        <li><a href="/timetables.html" title="horarios">&#x1f5d3</a></li>
        <li><a href="/references.html" title="bibliografia">&#x1f4da</a></li>
        <li><a href="/practicas.html" title="pr√°cticas">&#x270d</a></li>
        

        <li><a href="/clases.html" title="clases">üë®‚Äçüè´</a></li>
        <li><a href="/index.html" title="Home page">&#x1f3e0</a></li>
        <li><a href="/tema0-presentacion/" title="Tema 0: Presentaci√≥n">0</a></li>
        <li><a href="/tema1-introduccion/" title="Tema 1: introducci√≥n">1</a></li>
        <li><a href="/tema2-async/" title="Tema 2: Async">2</a></li>
        <li><a href="/tema3-web/" title="Tema 3: Web">3</a></li>
        <li><a href="/tema4-devops/" title="Tema 4: Devops">4</a></li>
        
    </nav>

    </div>
    <!-- end header -->


    <div class="wrapper">

        <section>
           
<div id="title">
        <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
        <p> Master de II. ULL. 1er cuatrimestre. 2020/2021</p>
        <hr>
        <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-2021" target="_blank">ULL-MII-SYTWS-2021</a></span>
        <span class="credits left"> &nbsp; Classroom <a href="https://classroom.github.com/classrooms/68184806-ull-mii-sytws-2021" target="_blank">ULL-MII-SYTWS-2021</a></span>
        <span class="credits left"> &nbsp; Campus Virtual <a href="https://campusdoctoradoyposgrado.ull.es/course/view.php?id=2020111300" target="_blank">SYTWS</a></span>
        <span class="credits left"> &nbsp; Chat <a href="https://chat.google.com/u/1/room/AAAAp18fCE8" target="_blank">Chat</a></span>
        <span class="credits left"> &nbsp; Profesor <a href="https://www.ull.es/apps/guias/guias/view_teacher_niu/745/(%3FPcrguezl.*)/" target="_blank">Casiano</a></span>
    </div>

<!--

<div id="title">
    <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
    <p> Master de II. ULL. 1er cuatrimestre. 2020/2021</p>
    <hr>
    <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-2021"
            target="_blank">ULL-MII-SYTWS-2021</a></span>
    <span class="credits left"> &nbsp; Github Classroom <a
            href="https://classroom.github.com/classrooms/55384072-master-de-ingenieria-informatica-sistemas-y-tecnologias-web-servidor-classroom"
            target="_blank">SYTWS 19/20</a></span>
    <span class="credits left"> &nbsp; Campus Virtual <a
            href="https://campusvirtual.ull.es/1920/course/view.php?id=201913778" target="_blank">SYTWS
            19/20</a></span>
    <span class="credits left"> &nbsp; Profesor <a
            href="https://www.ull.es/apps/guias/guias/view_teacher_niu/588/(%3FPcrguezl.*)/"" target="
            _blank">Casiano</a></span>
</div>
-->    


           
            <h2 >Table of Contents</h2>
           
            <ul id="sytwstoc">
  <li><a href="#the-async-module">The Async Module</a>
    <ul>
      <li><a href="#map">Map</a>
        <ul>
          <li><a href="#ejemplo-concatenaci√≥n-de-ficheros">Ejemplo: Concatenaci√≥n de ficheros</a>
            <ul>
              <li><a href="#como-lograr√≠a-resolver-este-problema-si-no-dispusiera-de-asyncjs">¬øComo lograr√≠a resolver este problema si no dispusiera de <code class="language-plaintext highlighter-rouge">async.js</code>?</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#filter">Filter</a></li>
      <li><a href="#parallel">Parallel</a>
        <ul>
          <li><a href="#it-is-also-possible-to-use-an-object-instead-of-an-array">It is also possible to use an object instead of an array</a></li>
          <li><a href="#example">Example:</a></li>
        </ul>
      </li>
      <li><a href="#series">Series</a>
        <ul>
          <li><a href="#it-is-also-possible-to-use-an-object-instead-of-an-array-1">It is also possible to use an object instead of an array</a></li>
          <li><a href="#example-1">Example</a></li>
        </ul>
      </li>
      <li><a href="#queue">Queue</a></li>
    </ul>
  </li>
</ul>
        

            <div class="container">
                <h1 id="the-async-module">The Async Module</h1>

<p><a href="https://caolan.github.io/async/v3/">Async</a> is a utility module which provides straight-forward, powerful functions for working with asynchronous JavaScript. Although originally designed for use with Node.js and installable via</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>npm install async
</pre></td></tr></tbody></table></code></pre></div></div>

<p>it can also be used directly in the browser.</p>

<h2 id="map">Map</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">async</span><span class="p">.</span><span class="nx">map</span><span class="p">([</span><span class="dl">'</span><span class="s1">file1</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">file2</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">file3</span><span class="dl">'</span><span class="p">],</span> <span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">cb</span><span class="p">),</span>  <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>  <span class="p">{</span>
      <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><a href="https://caolan.github.io/async/v3/docs.html#map">Documentation of Map</a></li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nx">map</span><span class="p">(</span>
     <span class="nx">coll</span><span class="p">,</span> 
     <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">iteratee</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span><span class="nx">cb</span><span class="p">),</span> 
     <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">maincallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>
   <span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>    <span class="k">import</span> <span class="nx">map</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">async/map</span><span class="dl">'</span><span class="p">;</span> 
    <span class="c1">// En Node.js</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">map</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">async</span><span class="dl">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>Produces a new collection of values by mapping each value in <code class="language-plaintext highlighter-rouge">coll</code> through the <code class="language-plaintext highlighter-rouge">iteratee</code> function.</li>
  <li>The <code class="language-plaintext highlighter-rouge">iteratee</code> is called with an <code class="language-plaintext highlighter-rouge">item</code> from <code class="language-plaintext highlighter-rouge">coll</code> and a callback <code class="language-plaintext highlighter-rouge">cb</code> for when it has finished processing.</li>
  <li>Each of these callbacks <code class="language-plaintext highlighter-rouge">cb</code> take 2 arguments: an <code class="language-plaintext highlighter-rouge">error</code>, and the result of  <code class="language-plaintext highlighter-rouge">iteratee(item)</code>.</li>
  <li>If <code class="language-plaintext highlighter-rouge">iteratee</code> passes an error to its callback <code class="language-plaintext highlighter-rouge">cb</code>, the <code class="language-plaintext highlighter-rouge">maincallback</code> (for the <code class="language-plaintext highlighter-rouge">map</code> function) is immediately called with the error.</li>
  <li>Note, that since this function applies the <code class="language-plaintext highlighter-rouge">iteratee</code> to each item in parallel, there is no guarantee that the <code class="language-plaintext highlighter-rouge">iteratee</code> functions will complete in order. However, <strong>the <code class="language-plaintext highlighter-rouge">results</code> array will be in the same order as the original <code class="language-plaintext highlighter-rouge">coll</code></strong>.</li>
</ol>

<h3 id="ejemplo-concatenaci√≥n-de-ficheros">Ejemplo: Concatenaci√≥n de ficheros</h3>

<p>El objetivo es escribir un programa que usando <code class="language-plaintext highlighter-rouge">fs.readFile</code> lea  un conjunto de ficheros pasados en v√≠a de comandos y produzca como salida la concatenaci√≥n de los mismos en el orden especificado, sin usar lecturas s√≠ncronas. 
La escritura debe ocurrir despu√©s que hayan terminado todas las lecturas.</p>

<p>He aqu√≠ una soluci√≥n:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>[~/.../ssh2-hello(master)]$ cat simp-reto-async-reading-multiple-files.js
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">{</span> <span class="nx">map</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">async</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">in1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">in2</span><span class="dl">'</span><span class="p">],</span>
    <span class="nx">output</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">out</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">map</span><span class="p">(</span><span class="nx">inputs</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">,</span>
   <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">contents</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">contents</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">);</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Output in file '</span><span class="p">${</span><span class="nx">output</span><span class="p">}</span><span class="s2">'`</span><span class="p">)</span>
        <span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ejecuci√≥n:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>[~/.../ssh2-hello(master)]$ node simp-reto-async-reading-multiple-files.js
Output in file 'out'
[~/.../ssh2-hello(master)]$ cat in1
in1
hi!
[~/.../ssh2-hello(master)]$ cat in2
in2
[~/.../ssh2-hello(master)]$ cat out
in1
hi!
in2
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="como-lograr√≠a-resolver-este-problema-si-no-dispusiera-de-asyncjs">¬øComo lograr√≠a resolver este problema si no dispusiera de <code class="language-plaintext highlighter-rouge">async.js</code>?</h4>

<h2 id="filter">Filter</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">async</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
    <span class="p">[</span><span class="dl">'</span><span class="s1">file1</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">file2</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">file3</span><span class="dl">'</span><span class="p">],</span>
    <span class="p">(</span><span class="nx">filePath</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">access</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span>  <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span>  <span class="o">!</span><span class="nx">err</span><span class="p">));</span>  <span class="c1">// Tests a user's permissions for file</span>
    <span class="p">},</span>  
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span>  <span class="p">{</span>
      <span class="c1">// results now equals an array of the existing files</span>
   <span class="p">}</span>
<span class="p">);</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><a href="https://caolan.github.io/async/v3/docs.html#filter">Documentation of filter</a></li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">filter</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">async/filter</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">filter</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">iteratee</span><span class="p">,</span> <span class="nx">callbackopt</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>Returns a new array of all the values in <code class="language-plaintext highlighter-rouge">coll</code> which pass an async truth test.</li>
  <li>This operation is performed in parallel, but the results array will be in the same order as the original.</li>
  <li><code class="language-plaintext highlighter-rouge">iteratee</code> is a truth test to apply to each item in <code class="language-plaintext highlighter-rouge">coll</code>.
    <ul>
      <li>The <code class="language-plaintext highlighter-rouge">iteratee</code> is invoked with <code class="language-plaintext highlighter-rouge">(item, callback)</code></li>
      <li>It is passed a <code class="language-plaintext highlighter-rouge">callback(err, truthValue)</code>, <strong>which must be called with a boolean argument once it has completed</strong></li>
    </ul>
  </li>
</ol>

<h2 id="parallel">Parallel</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">(</span>
   <span class="p">[</span>
     <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">one</span><span class="dl">'</span><span class="p">);</span> <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
     <span class="p">},</span>
     <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">two</span><span class="dl">'</span><span class="p">);</span> <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">],</span>
  <span class="c1">// optional callback</span>
  <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// the results array will equal ['one','two'] even though</span>
    <span class="c1">// the second function had a shorter timeout.</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><a href="https://caolan.github.io/async/v3/docs.html#parallel">Documentation of Parallel</a></li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>    <span class="k">import</span> <span class="nx">parallel</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">async/parallel</span><span class="dl">'</span><span class="p">;</span>

    <span class="nx">parallel</span><span class="p">(</span><span class="nx">tasks</span><span class="p">,</span> <span class="nx">callbackopt</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>Run the <code class="language-plaintext highlighter-rouge">tasks</code> collection of functions in parallel, without waiting until the previous function has completed.</li>
  <li>If any of the functions pass an error to its callback, the main <code class="language-plaintext highlighter-rouge">callback</code> is immediately called with the value of the error.</li>
  <li>Once the <code class="language-plaintext highlighter-rouge">tasks</code> have completed, the results are passed to the final <code class="language-plaintext highlighter-rouge">callback</code> as an array.</li>
</ol>

<p><strong>Hint:</strong> Use <a href="https://caolan.github.io/async/v3/docs.html#reflect"><code class="language-plaintext highlighter-rouge">reflect</code></a> to continue the execution of other tasks when a task fails.</p>

<h3 id="it-is-also-possible-to-use-an-object-instead-of-an-array">It is also possible to use an object instead of an array</h3>

<p>Each property will be run as a function and the results will be passed to the final <code class="language-plaintext highlighter-rouge">callback</code> as an object instead of an array.</p>

<p>This can be a more readable way of handling results from <code class="language-plaintext highlighter-rouge">async.parallel</code></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>
<span class="c1">// an example using an object instead of an array</span>
<span class="k">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">({</span>
    <span class="na">one</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">two</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now equals to: {one: 1, two: 2}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="example">Example:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>[~/.../Asyncjs]$ cat parallelTimers.js
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="k">async</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span><span class="dl">'</span><span class="s1">async</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
<span class="k">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">([</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Completed in </span><span class="dl">'</span> <span class="o">+</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">ms</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Execution:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[~/.../async-js-book/Asyncjs]$ node parallelTimers.js
Completed in 305ms
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="series">Series</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">async</span><span class="p">.</span><span class="nx">series</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do some stuff ...</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">one</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do some more stuff ...</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">two</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">],</span>
<span class="c1">// optional callback</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now equal to ['one', 'two']</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>Documentation of <a href="https://caolan.github.io/async/v3/docs.html#series">series</a></li>
</ul>

<p><strong><code class="language-plaintext highlighter-rouge">series(tasks, callbackopt)</code></strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">series</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">async/series</span><span class="dl">'</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>Run the functions in the <code class="language-plaintext highlighter-rouge">tasks</code> collection in series, <strong>each one running once the previous function has completed</strong>.</li>
  <li>If any functions in the series pass an error to its callback, no more functions are run, and <code class="language-plaintext highlighter-rouge">callback</code> is immediately called with the value of the error.</li>
  <li>Otherwise, <code class="language-plaintext highlighter-rouge">callback</code> receives an array of results when <code class="language-plaintext highlighter-rouge">tasks</code> have completed.</li>
</ol>

<h3 id="it-is-also-possible-to-use-an-object-instead-of-an-array-1">It is also possible to use an object instead of an array</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">async</span><span class="p">.</span><span class="nx">series</span><span class="p">({</span>
    <span class="na">one</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">two</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now equal to: {one: 1, two: 2}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Each property will be run as a function, and the results will be passed to the final <code class="language-plaintext highlighter-rouge">callback</code> as an object instead of an array.</p>

<p>This can be a more readable way of handling results from <code class="language-plaintext highlighter-rouge">async.series</code>.</p>

<p><strong>Note</strong> that while many implementations preserve the order of object properties, the <a href="http://www.ecma-international.org/ecma-262/5.1/#sec-8.6">ECMAScript Language Specification</a> explicitly states that</p>

<blockquote>
  <p>The mechanics and order of enumerating the properties is not specified.</p>
</blockquote>

<p>So if you rely on the order in which your series of functions are executed, and want this to work on all platforms, consider using an array.</p>

<h3 id="example-1">Example</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>[~/.../async-js-book/Asyncjs]$ cat seriesTimers.js
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="k">async</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span><span class="dl">'</span><span class="s1">async</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>

<span class="k">async</span><span class="p">.</span><span class="nx">series</span><span class="p">([</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span> <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// show time elapsed since start</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Completed in </span><span class="dl">'</span> <span class="o">+</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">ms</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[~/.../async-js-book/Asyncjs]$ node seriesTimers.js
Completed in 618ms
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="queue">Queue</h2>

<p>See <a href="http://caolan.github.io/async/v3/docs.html#queue">Async.js: queue</a></p>

<p>Creates a <code class="language-plaintext highlighter-rouge">queue</code> object with the specified <code class="language-plaintext highlighter-rouge">concurrency</code>. Tasks added to the <code class="language-plaintext highlighter-rouge">queue</code> are processed in parallel (up to the <code class="language-plaintext highlighter-rouge">concurrency</code> limit). If all worker‚Äôs are in progress, the task is queued until one becomes available. Once a <code class="language-plaintext highlighter-rouge">worker</code> completes a <code class="language-plaintext highlighter-rouge">task</code>, that <code class="language-plaintext highlighter-rouge">task</code>‚Äôs callback is called.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>[~/.../async-js-book/Asyncjs]$ cat queue-example.js
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="k">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">async</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ir</span> <span class="o">=</span> <span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">)</span> <span class="o">+</span> <span class="nx">min</span><span class="p">))</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">makeCb</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">finished processing </span><span class="dl">'</span><span class="o">+</span><span class="nx">str</span><span class="o">+</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">d</span><span class="p">)));</span>

<span class="kd">const</span> <span class="nx">worker</span> <span class="o">=</span> <span class="p">(</span><span class="nx">task</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span>
      <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">task</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
        <span class="nx">callback</span><span class="p">();</span>
      <span class="p">},</span><span class="nx">ir</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">// Wait a random time</span>
    <span class="p">)</span>
<span class="p">};</span>

<span class="c1">// create a queue object with concurrency 2</span>
<span class="kd">const</span> <span class="nx">q</span> <span class="o">=</span> <span class="k">async</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="nx">worker</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="cm">/*
 q.drain: a function that sets a callback that is called when the last item
          from the queue has returned from the worker.
  If the callback is omitted, q.drain() returns a promise for the next occurrence.
*/</span>
<span class="nx">q</span><span class="p">.</span><span class="nx">drain</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">worker finished and queue is empty</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// assign an error callback</span>
<span class="nx">q</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">task</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">task experienced an error </span><span class="dl">'</span><span class="o">+</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>[~/.../async-js-book/Asyncjs]$ node queue-example.js
hello ear
finished processing ear 709
hello bar
finished processing bar 961
hello foo
finished processing foo 976
hello baz
finished processing item 1186
hello bay
finished processing item 1316
hello bax
finished processing item 1323
worker finished and queue is empty
</pre></td></tr></tbody></table></code></pre></div></div>

            </div>
                        <details>
                <summary><h2>Comment with GitHub Utterances</h2></summary>
                <script src="https://utteranc.es/client.js"
        repo="ULL-MII-SYTWS-1920/ull-mii-sytws-1920.github.io"
        issue-term="pathname"
        label="SYTWS"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>
            </details>
            
            <details>
                <summary>
                   <h2>Comment with Disqus</h2> 
                </summary>              
                



<div id="disqus_thread">
    thread de discusion
</div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: 
EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
       https://disqus.com/admin/universalcode/#configuration-variables*/

/*
var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://https-ull-mii-sytws-1920-github-io.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
   (d.head || d.body).appendChild(s);
})();

</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            

 

            </details>

            <!-- -->
            <!-- end bar -->

            <!-- Mathjax Support  -->
            <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


        </section>
    </div>

    
</body>

</html>
