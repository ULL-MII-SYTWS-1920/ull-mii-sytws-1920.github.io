<!doctype html>
<html lang=" en-US ">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=88e715cdd6e0bd047c7d68b39d123a466842e492">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->

    
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        
    
</head>

<body>
    <div id="header">
            <nav>
        <li><a href="https://github.com/ULL-MII-SYTWS-1920/ull-mii-sytws-1920.github.io/tree/master//tema2-async/event-loop/exercises/web-workers/node_modules/safer-buffer/Readme.md" title="Edit this page at GitHub">üêô</a>
        </li>
        <li><a href="/search" title="search">&#x1F50D;</a></li>
       
        <li><a href="/resources.html" title="resources">&#x2699</a></li>
        <li><a href="/timetables.html" title="horarios">&#x1f5d3</a></li>
        <li><a href="/references.html" title="bibliografia">&#x1f4da</a></li>
        <li><a href="/practicas.html" title="pr√°cticas">&#x270d</a></li>
        

        <li><a href="/clases.html" title="clases">üë®‚Äçüè´</a></li>
        <li><a href="/index.html" title="Home page">&#x1f3e0</a></li>
        <li><a href="/tema0-presentacion/" title="Tema 0: Presentaci√≥n">0</a></li>
        <li><a href="/tema1-introduccion/" title="Tema 1: introducci√≥n">1</a></li>
        <li><a href="/tema2-async/" title="Tema 2: Async">2</a></li>
        <li><a href="/tema3-web/" title="Tema 3: Web">3</a></li>
        <li><a href="/tema4-devops/" title="Tema 4: Devops">4</a></li>
        
    </nav>

    </div>
    <!-- end header -->


    <div class="wrapper">

        <section>
           
<div id="title">
        <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
        <p> Master de II. ULL. 1er cuatrimestre. 2020/2021</p>
        <hr>
        <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-2021" target="_blank">ULL-MII-SYTWS-2021</a></span>
        <span class="credits left"> &nbsp; Classroom <a href="https://classroom.github.com/classrooms/68184806-ull-mii-sytws-2021" target="_blank">ULL-MII-SYTWS-2021</a></span>
        <span class="credits left"> &nbsp; Campus Virtual <a href="https://campusdoctoradoyposgrado.ull.es/course/view.php?id=2020111300" target="_blank">SYTWS</a></span>
        <span class="credits left"> &nbsp; Chat <a href="https://chat.google.com/u/1/room/AAAAp18fCE8" target="_blank">Chat</a></span>
        <span class="credits left"> &nbsp; Profesor <a href="https://www.ull.es/apps/guias/guias/view_teacher_niu/745/(%3FPcrguezl.*)/" target="_blank">Casiano</a></span>
    </div>

<!--

<div id="title">
    <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
    <p> Master de II. ULL. 1er cuatrimestre. 2020/2021</p>
    <hr>
    <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-1920"
            target="_blank">ULL-MII-SYTWS-1920</a></span>
    <span class="credits left"> &nbsp; Github Classroom <a
            href="https://classroom.github.com/classrooms/55384072-master-de-ingenieria-informatica-sistemas-y-tecnologias-web-servidor-classroom"
            target="_blank">SYTWS 19/20</a></span>
    <span class="credits left"> &nbsp; Campus Virtual <a
            href="https://campusvirtual.ull.es/1920/course/view.php?id=201913778" target="_blank">SYTWS
            19/20</a></span>
    <span class="credits left"> &nbsp; Profesor <a
            href="https://www.ull.es/apps/guias/guias/view_teacher_niu/588/(%3FPcrguezl.*)/"" target="
            _blank">Casiano</a></span>
</div>
-->    


           
            <h2 >Table of Contents</h2>
           
            <ul id="sytwstoc">
  <li><a href="#safer-buffer----">safer-buffer <a href="https://travis-ci.org/ChALkeR/safer-buffer"><img src="https://travis-ci.org/ChALkeR/safer-buffer.svg?branch=master" alt="travis" /></a> <a href="https://npmjs.org/package/safer-buffer"><img src="https://img.shields.io/npm/v/safer-buffer.svg" alt="npm" /></a> <a href="https://standardjs.com"><img src="https://img.shields.io/badge/code_style-standard-brightgreen.svg" alt="javascript style guide" /></a> <a href="https://github.com/nodejs/security-wg/blob/master/processes/responsible_disclosure_template.md"><img src="https://img.shields.io/badge/Security-Responsible%20Disclosure-green.svg" alt="Security Responsible Disclosure" /></a></a>
    <ul>
      <li><a href="#how-to-use">How to use?</a></li>
      <li><a href="#do-i-need-it">Do I need it?</a></li>
      <li><a href="#why-not-safe-buffer">Why not <a href="https://npmjs.com/safe-buffer">safe-buffer</a>?</a></li>
      <li><a href="#but-isnt-throwing-bad">But isn‚Äôt throwing bad?</a>
        <ul>
          <li><a href="#would-it-affect-third-party-modules">Would it affect third-party modules?</a></li>
          <li><a href="#but-i-dont-want-throwing">But I don‚Äôt want throwing‚Ä¶</a></li>
        </ul>
      </li>
      <li><a href="#without-footguns">¬´Without footguns¬ª?</a></li>
    </ul>
  </li>
</ul>
        

            <div class="container">
                <h1 id="safer-buffer----">safer-buffer <a href="https://travis-ci.org/ChALkeR/safer-buffer"><img src="https://travis-ci.org/ChALkeR/safer-buffer.svg?branch=master" alt="travis" /></a> <a href="https://npmjs.org/package/safer-buffer"><img src="https://img.shields.io/npm/v/safer-buffer.svg" alt="npm" /></a> <a href="https://standardjs.com"><img src="https://img.shields.io/badge/code_style-standard-brightgreen.svg" alt="javascript style guide" /></a> <a href="https://github.com/nodejs/security-wg/blob/master/processes/responsible_disclosure_template.md"><img src="https://img.shields.io/badge/Security-Responsible%20Disclosure-green.svg" alt="Security Responsible Disclosure" /></a></h1>

<p>Modern Buffer API polyfill without footguns, working on Node.js from 0.8 to current.</p>

<h2 id="how-to-use">How to use?</h2>

<p>First, port all <code class="language-plaintext highlighter-rouge">Buffer()</code> and <code class="language-plaintext highlighter-rouge">new Buffer()</code> calls to <code class="language-plaintext highlighter-rouge">Buffer.alloc()</code> and <code class="language-plaintext highlighter-rouge">Buffer.from()</code> API.</p>

<p>Then, to achieve compatibility with outdated Node.js versions (<code class="language-plaintext highlighter-rouge">&lt;4.5.0</code> and 5.x <code class="language-plaintext highlighter-rouge">&lt;5.9.0</code>), use
<code class="language-plaintext highlighter-rouge">const Buffer = require('safer-buffer').Buffer</code> in all files where you make calls to the new
Buffer API. <em>Use <code class="language-plaintext highlighter-rouge">var</code> instead of <code class="language-plaintext highlighter-rouge">const</code> if you need that for your Node.js version range support.</em></p>

<p>Also, see the
<a href="https://github.com/ChALkeR/safer-buffer/blob/master/Porting-Buffer.md">porting Buffer</a> guide.</p>

<h2 id="do-i-need-it">Do I need it?</h2>

<p>Hopefully, not ‚Äî dropping support for outdated Node.js versions should be fine nowdays, and that
is the recommended path forward. You <em>do</em> need to port to the <code class="language-plaintext highlighter-rouge">Buffer.alloc()</code> and <code class="language-plaintext highlighter-rouge">Buffer.from()</code>
though.</p>

<p>See the <a href="https://github.com/ChALkeR/safer-buffer/blob/master/Porting-Buffer.md">porting guide</a>
for a better description.</p>

<h2 id="why-not-safe-buffer">Why not <a href="https://npmjs.com/safe-buffer">safe-buffer</a>?</h2>

<p><em>In short: while <code class="language-plaintext highlighter-rouge">safe-buffer</code> serves as a polyfill for the new API, it allows old API usage and
itself contains footguns.</em></p>

<p><code class="language-plaintext highlighter-rouge">safe-buffer</code> could be used safely to get the new API while still keeping support for older
Node.js versions (like this module), but while analyzing ecosystem usage of the old Buffer API
I found out that <code class="language-plaintext highlighter-rouge">safe-buffer</code> is itself causing problems in some cases.</p>

<p>For example, consider the following snippet:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>example.unsafe.js
<span class="go">console.log(Buffer(20))
</span><span class="gp">$</span><span class="w"> </span>./node-v6.13.0-linux-x64/bin/node example.unsafe.js
<span class="gp">&lt;Buffer 0a 00 00 00 00 00 00 00 28 13 de 02 00 00 00 00 05 00 00 00&gt;</span><span class="w">
</span><span class="gp">$</span><span class="w"> </span>standard example.unsafe.js
<span class="go">standard: Use JavaScript Standard Style (https://standardjs.com)
  /home/chalker/repo/safer-buffer/example.unsafe.js:2:13: 'Buffer()' was deprecated since v6. Use 'Buffer.alloc()' or 'Buffer.from()' (use 'https://www.npmjs.com/package/safe-buffer' for '&lt;4.5.0') instead.
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>This is allocates and writes to console an uninitialized chunk of memory.
<a href="https://www.npmjs.com/package/standard">standard</a> linter (among others) catch that and warn people
to avoid using unsafe API.</p>

<p>Let‚Äôs now throw in <code class="language-plaintext highlighter-rouge">safe-buffer</code>!</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>example.safe-buffer.js
<span class="go">const Buffer = require('safe-buffer').Buffer
console.log(Buffer(20))
</span><span class="gp">$</span><span class="w"> </span>standard example.safe-buffer.js
<span class="gp">$</span><span class="w"> </span>./node-v6.13.0-linux-x64/bin/node example.safe-buffer.js
<span class="gp">&lt;Buffer 08 00 00 00 00 00 00 00 28 58 01 82 fe 7f 00 00 00 00 00 00&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>See the problem? Adding in <code class="language-plaintext highlighter-rouge">safe-buffer</code> <em>magically removes the lint warning</em>, but the behavior
remains identi—Åal to what we had before, and when launched on Node.js 6.x LTS ‚Äî this dumps out
chunks of uninitialized memory.
<em>And this code will still emit runtime warnings on Node.js 10.x and above.</em></p>

<p>That was done by design. I first considered changing <code class="language-plaintext highlighter-rouge">safe-buffer</code>, prohibiting old API usage or
emitting warnings on it, but that significantly diverges from <code class="language-plaintext highlighter-rouge">safe-buffer</code> design. After some
discussion, it was decided to move my approach into a separate package, and <em>this is that separate
package</em>.</p>

<p>This footgun is not imaginary ‚Äî I observed top-downloaded packages doing that kind of thing,
¬´fixing¬ª the lint warning by blindly including <code class="language-plaintext highlighter-rouge">safe-buffer</code> without any actual changes.</p>

<p>Also in some cases, even if the API <em>was</em> migrated to use of safe Buffer API ‚Äî a random pull request
can bring unsafe Buffer API usage back to the codebase by adding new calls ‚Äî and that could go
unnoticed even if you have a linter prohibiting that (becase of the reason stated above), and even
pass CI. <em>I also observed that being done in popular packages.</em></p>

<p>Some examples:</p>
<ul>
  <li><a href="https://github.com/webdriverio/webdriverio/commit/05cbd3167c12e4930f09ef7cf93b127ba4effae4#diff-124380949022817b90b622871837d56cR31">webdriverio</a>
(a module with 548 759 downloads/month),</li>
  <li><a href="https://github.com/maxogden/websocket-stream/commit/c9312bd24d08271687d76da0fe3c83493871cf61">websocket-stream</a>
(218 288 d/m, fix in <a href="https://github.com/maxogden/websocket-stream/pull/142">maxogden/websocket-stream#142</a>),</li>
  <li><a href="https://github.com/node-serialport/node-serialport/commit/e8d9d2b16c664224920ce1c895199b1ce2def48c">node-serialport</a>
(113 138 d/m, fix in <a href="https://github.com/node-serialport/node-serialport/pull/1510">node-serialport/node-serialport#1510</a>),</li>
  <li><a href="https://github.com/karma-runner/karma/commit/3d94b8cf18c695104ca195334dc75ff054c74eec">karma</a>
(3 973 193 d/m, fix in <a href="https://github.com/karma-runner/karma/pull/2947">karma-runner/karma#2947</a>),</li>
  <li><a href="https://github.com/spdy-http2/spdy-transport/commit/5375ac33f4a62a4f65bcfc2827447d42a5dbe8b1">spdy-transport</a>
(5 970 727 d/m, fix in <a href="https://github.com/spdy-http2/spdy-transport/pull/53">spdy-http2/spdy-transport#53</a>).</li>
  <li>And there are a lot more over the ecosystem.</li>
</ul>

<p>I filed a PR at
<a href="https://github.com/mysticatea/eslint-plugin-node/pull/110">mysticatea/eslint-plugin-node#110</a> to
partially fix that (for cases when that lint rule is used), but it is a semver-major change for
linter rules and presets, so it would take significant time for that to reach actual setups.
<em>It also hasn‚Äôt been released yet (2018-03-20).</em></p>

<p>Also, <code class="language-plaintext highlighter-rouge">safer-buffer</code> discourages the usage of <code class="language-plaintext highlighter-rouge">.allocUnsafe()</code>, which is often done by a mistake.
It still supports it with an explicit concern barier, by placing it under
<code class="language-plaintext highlighter-rouge">require('safer-buffer/dangereous')</code>.</p>

<h2 id="but-isnt-throwing-bad">But isn‚Äôt throwing bad?</h2>

<p>Not really. It‚Äôs an error that could be noticed and fixed early, instead of causing havoc later like
unguarded <code class="language-plaintext highlighter-rouge">new Buffer()</code> calls that end up receiving user input can do.</p>

<p>This package affects only the files where <code class="language-plaintext highlighter-rouge">var Buffer = require('safer-buffer').Buffer</code> was done, so
it is really simple to keep track of things and make sure that you don‚Äôt mix old API usage with that.
Also, CI should hint anything that you might have missed.</p>

<p>New commits, if tested, won‚Äôt land new usage of unsafe Buffer API this way.
<em>Node.js 10.x also deals with that by printing a runtime depecation warning.</em></p>

<h3 id="would-it-affect-third-party-modules">Would it affect third-party modules?</h3>

<p>No, unless you explicitly do an awful thing like monkey-patching or overriding the built-in <code class="language-plaintext highlighter-rouge">Buffer</code>.
Don‚Äôt do that.</p>

<h3 id="but-i-dont-want-throwing">But I don‚Äôt want throwing‚Ä¶</h3>

<p>That is also fine!</p>

<p>Also, it could be better in some cases when you don‚Äôt comprehensive enough test coverage.</p>

<p>In that case ‚Äî just don‚Äôt override <code class="language-plaintext highlighter-rouge">Buffer</code> and use
<code class="language-plaintext highlighter-rouge">var SaferBuffer = require('safer-buffer').Buffer</code> instead.</p>

<p>That way, everything using <code class="language-plaintext highlighter-rouge">Buffer</code> natively would still work, but there would be two drawbacks:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Buffer.from</code>/<code class="language-plaintext highlighter-rouge">Buffer.alloc</code> won‚Äôt be polyfilled ‚Äî use <code class="language-plaintext highlighter-rouge">SaferBuffer.from</code> and
<code class="language-plaintext highlighter-rouge">SaferBuffer.alloc</code> instead.</li>
  <li>You are still open to accidentally using the insecure deprecated API ‚Äî use a linter to catch that.</li>
</ul>

<p>Note that using a linter to catch accidential <code class="language-plaintext highlighter-rouge">Buffer</code> constructor usage in this case is strongly
recommended. <code class="language-plaintext highlighter-rouge">Buffer</code> is not overriden in this usecase, so linters won‚Äôt get confused.</p>

<h2 id="without-footguns">¬´Without footguns¬ª?</h2>

<p>Well, it is still possible to do <em>some</em> things with <code class="language-plaintext highlighter-rouge">Buffer</code> API, e.g. accessing <code class="language-plaintext highlighter-rouge">.buffer</code> property
on older versions and duping things from there. You shouldn‚Äôt do that in your code, probabably.</p>

<p>The intention is to remove the most significant footguns that affect lots of packages in the
ecosystem, and to do it in the proper way.</p>

<p>Also, this package doesn‚Äôt protect against security issues affecting some Node.js versions, so for
usage in your own production code, it is still recommended to update to a Node.js version
<a href="https://github.com/nodejs/release#release-schedule">supported by upstream</a>.</p>

            </div>
                        <details>
                <summary><h2>Comment with GitHub Utterances</h2></summary>
                <script src="https://utteranc.es/client.js"
        repo="ULL-MII-SYTWS-1920/ull-mii-sytws-1920.github.io"
        issue-term="pathname"
        label="SYTWS"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>
            </details>
            
            <details>
                <summary>
                   <h2>Comment with Disqus</h2> 
                </summary>              
                



<div id="disqus_thread">
    thread de discusion
</div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: 
EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
       https://disqus.com/admin/universalcode/#configuration-variables*/

/*
var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://https-ull-mii-sytws-1920-github-io.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
   (d.head || d.body).appendChild(s);
})();

</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            

 

            </details>

            <!-- -->
            <!-- end bar -->

            <!-- Mathjax Support  -->
            <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


        </section>
    </div>

    
</body>

</html>
